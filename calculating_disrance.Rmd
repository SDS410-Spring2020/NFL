---
title: "Calculating_distance"
author: "Aoi Ogawa"
date: "2/28/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
# importing libraries
library(datasets)
library(maps)
library(tidyr)
library(tidyverse)
library(readr)
# install.packages("geosphere")
library(geosphere)
library(dplyr)
library(data.table)
```


```{r, include=FALSE}
# importing data
games<-read.csv("data/games_Smith.csv")
pbp<-read.csv("data/pbp_Smith.csv")
stadium_data_coordinates <- read.csv("stadium_data_coordinates.csv")
visit_team_data <- read_csv("visit_team_data.csv")
```

```{r}
games_w_coordinates <- games %>%
  inner_join(stadium_data_coordinates)

games_w_coordinates <- games_w_coordinates %>%
  inner_join(visit_team_data)

games_w_coordinates$num <-NULL
games_w_coordinates$additional_info_location <- NULL
colnames(games_w_coordinates)[colnames(games_w_coordinates) == 'longitude'] <- 'Home_lat'
colnames(games_w_coordinates)[colnames(games_w_coordinates) == 'latitude'] <- 'Home_long'

games_w_coordinates <- games_w_coordinates[!duplicated(games_w_coordinates$GameKey), ]

remove.list <- paste(c('Wembley Stadium',"Rogers Centre","Wembley","Twickenham","Estadio Azteca","Twickenham Stadium","Azteca Stadium","Tottenham Hotspur Stadium","Tottenham Hotspur"), collapse = '|')

domestic_games <- games_w_coordinates %>%
  filter(!grepl(remove.list, Stadium))

domestic_games <- domestic_games[!duplicated(domestic_games$GameKey), ]

international_games <- games_w_coordinates %>%
  filter(grepl(remove.list, Stadium))

international_games <- international_games[!duplicated(international_games$GameKey), ]
```

```{r}
# calculate distance

calc_domestic <- domestic_games %>% 
  rowwise() %>%
  mutate(distance = distCosine(c(Home_long, Home_lat),c(Visit_long, Visit_lat)))

calc_domestic <- calc_domestic[!duplicated(calc_domestic$GameKey), ]

```

```{r}
without_season_dis <- calc_domestic %>%
  group_by(Home_Team,Visit_Team,distance) %>%
  summarise(num=n())

season_dis <- calc_domestic %>%
  group_by(Home_Team,Visit_Team,distance,Season) %>%
  summarise(num=n())

season_num_games_home <- calc_domestic %>%
  group_by(Home_Team,Season) %>%
  summarise(host_num=n())

season_num_games_visit <- calc_domestic %>%
  group_by(Visit_Team,Season) %>%
  summarise(visit_num=n())

# total_season_game <- season_num_games_home %>%
#   inner_join(season_num_games_visit) %>%
#   mutate(sum = host_num + visit_num)

```


