---
title: "Calculating_distance"
author: "Aoi Ogawa"
date: "2/28/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
# importing libraries
library(datasets)
library(maps)
library(tidyr)
library(tidyverse)
library(readr)
# install.packages("geosphere")
library(geosphere)
library(dplyr)
library(sp)
library(leaflet)
library(magrittr)
```


```{r, include=FALSE}
# importing data
games<-read.csv("data/games_Smith.csv")
pbp<-read.csv("data/pbp_Smith.csv")
stadium_data_coordinates <- read.csv("stadium_data_coordinates.csv")
visit_team_data <- read_csv("visit_team_data.csv")
```

```{r}
games_w_coordinates <- games %>%
  inner_join(stadium_data_coordinates)

games_w_coordinates <- games_w_coordinates %>%
  inner_join(visit_team_data)

games_w_coordinates$num <-NULL
games_w_coordinates$additional_info_location <- NULL
colnames(games_w_coordinates)[colnames(games_w_coordinates) == 'longitude'] <- 'Home_lat'
colnames(games_w_coordinates)[colnames(games_w_coordinates) == 'latitude'] <- 'Home_long'

games_w_coordinates <- games_w_coordinates[!duplicated(games_w_coordinates$GameKey), ]

remove.list <- paste(c('Wembley Stadium',"Rogers Centre","Wembley","Twickenham","Estadio Azteca","Twickenham Stadium","Azteca Stadium","Tottenham Hotspur Stadium","Tottenham Hotspur"), collapse = '|')

domestic_games <- games_w_coordinates %>%
  filter(!grepl(remove.list, Stadium))

domestic_games <- domestic_games[!duplicated(domestic_games$GameKey), ]

international_games <- games_w_coordinates %>%
  filter(grepl(remove.list, Stadium))

international_games <- international_games[!duplicated(international_games$GameKey), ]
```

```{r}
# calculate distance

calc_domestic <- domestic_games %>% 
  rowwise() %>%
  mutate(distance_m = distCosine(c(Home_long, Home_lat),c(Visit_long, Visit_lat))) %>%
  mutate(distance_mile = distance_m*0.6214/1000)

calc_domestic <- calc_domestic[!duplicated(calc_domestic$GameKey), ]

calc_domestic <- calc_domestic %>%
  mutate(distance = ifelse(distance_mile > 2000, "very far",
                           ifelse(distance_mile > 1000 && distance_mile <= 2000, "far", "close")))

domestic_distance <- calc_domestic %>%
  group_by(distance) %>%
  summarise(num =n())

```

```{r}
without_season_dis <- calc_domestic %>%
  group_by(Home_Team,Visit_Team,distance_mile) %>%
  summarise(num=n())

season_dis <- calc_domestic %>%
  group_by(Home_Team,Visit_Team,distance_mile,Season) %>%
  summarise(num=n())

season_num_games_home <- calc_domestic %>%
  group_by(Home_Team,Season) %>%
  summarise(host_num=n())

season_num_games_visit <- calc_domestic %>%
  group_by(Visit_Team,Season) %>%
  summarise(visit_num=n())

```

```{r}
# Creating datasets based on season

season_2007 <- calc_domestic %>%
  filter(Season=="2007")

season_2008 <- calc_domestic %>%
  filter(Season=="2008")

season_2009 <- calc_domestic %>%
  filter(Season=="2009")

season_2010 <- calc_domestic %>%
  filter(Season=="2010")

season_2011 <- calc_domestic %>%
  filter(Season=="2011")

season_2012 <- calc_domestic %>%
  filter(Season=="2012")

season_2013 <- calc_domestic %>%
  filter(Season=="2013")

season_2014 <- calc_domestic %>%
  filter(Season=="2014")

season_2015 <- calc_domestic %>%
  filter(Season=="2015")

season_2016 <- calc_domestic %>%
  filter(Season=="2016")

season_2017 <- calc_domestic %>%
  filter(Season=="2017")

season_2018 <- calc_domestic %>%
  filter(Season=="2018")

season_2019 <- calc_domestic %>%
  filter(Season=="2019")
```

```{r}

mapping_Arizona_Cardinals_2007 <-season_2007 %>%
  filter(Visit_Team == "Arizona Cardinals")


Arizona_mapping_2007 <- mapping_Arizona_Cardinals_2007 %>% 
  leaflet() %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  setView(-93.65, 42.0285, zoom = 4.3) %>%
  addMarkers(~Visit_long, ~Visit_lat) %>%
  addMarkers(~Home_long, ~Home_lat) %>%
  addMarkers(
    lng = mapping_Arizona_Cardinals_2007$Visit_long, lat = mapping_Arizona_Cardinals_2007$Visit_lat,
    label = mapping_Arizona_Cardinals_2007$Visit_Team,
    labelOptions = labelOptions(noHide = T))

# %>%
#   addPolylines(data = Lines_from_arizona_2007, lng = ~long, lat = ~lat, group = ~group)

for (i in 1:nrow(mapping_Arizona_Cardinals_2007)) 
Arizona_mapping_2007<-Arizona_mapping_2007 %>%
  addPolylines(lat=c(mapping_Arizona_Cardinals_2007[i,]$Visit_lat,mapping_Arizona_Cardinals_2007[i,]$Home_lat),lng=c(mapping_Arizona_Cardinals_2007[i,]$Visit_long,mapping_Arizona_Cardinals_2007[i,]$Home_long)) %>%
  addMarkers(
    lng = mapping_Arizona_Cardinals_2007[i,]$Home_long, lat = mapping_Arizona_Cardinals_2007[i,]$Home_lat,
    label = mapping_Arizona_Cardinals_2007[i,]$Home_Team,
    labelOptions = labelOptions(noHide = T))

Arizona_mapping_2007
```


```{r}

mapping_Miami_Dolphins_2016 <-season_2016 %>%
  filter(Visit_Team == "Miami Dolphins")


miami_mapping_2016 <- mapping_Miami_Dolphins_2016 %>% 
  leaflet() %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  setView(-93.65, 42.0285, zoom = 4.3) %>%
  addMarkers(~Visit_long, ~Visit_lat) %>%
  addMarkers(~Home_long, ~Home_lat) %>%
  addMarkers(
    lng = mapping_Miami_Dolphins_2016$Visit_long, lat = mapping_Miami_Dolphins_2016$Visit_lat,
    label = mapping_Miami_Dolphins_2016$Visit_Team,
    labelOptions = labelOptions(noHide = T))

# %>%
#   addPolylines(data = Lines_from_arizona_2007, lng = ~long, lat = ~lat, group = ~group)

for (i in 1:nrow(mapping_Miami_Dolphins_2016)) 
miami_mapping_2016<-miami_mapping_2016 %>%
  addPolylines(lat=c(mapping_Miami_Dolphins_2016[i,]$Visit_lat,mapping_Miami_Dolphins_2016[i,]$Home_lat),lng=c(mapping_Miami_Dolphins_2016[i,]$Visit_long,mapping_Miami_Dolphins_2016[i,]$Home_long)) %>%
  addMarkers(
    lng = mapping_Miami_Dolphins_2016[i,]$Home_long, lat = mapping_Miami_Dolphins_2016[i,]$Home_lat,
    label = mapping_Miami_Dolphins_2016[i,]$Home_Team,
    labelOptions = labelOptions(noHide = T))

miami_mapping_2016
```

```{r}

mapping_New_York_Giants_2016 <-season_2016 %>%
  filter(Visit_Team == "New York Giants")


NY_Giants_mapping_2016 <- mapping_New_York_Giants_2016 %>% 
  leaflet() %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  setView(-93.65, 42.0285, zoom = 4.3) %>%
  addMarkers(~Visit_long, ~Visit_lat) %>%
  addMarkers(~Home_long, ~Home_lat) %>%
  addMarkers(
    lng = mapping_New_York_Giants_2016$Visit_long, lat = mapping_New_York_Giants_2016$Visit_lat,
    label = mapping_New_York_Giants_2016$Visit_Team,
    labelOptions = labelOptions(noHide = T))

# %>%
#   addPolylines(data = Lines_from_arizona_2007, lng = ~long, lat = ~lat, group = ~group)

for (i in 1:nrow(mapping_New_York_Giants_2016)) 
NY_Giants_mapping_2016<-NY_Giants_mapping_2016 %>%
  addPolylines(lat=c(mapping_New_York_Giants_2016[i,]$Visit_lat,mapping_New_York_Giants_2016[i,]$Home_lat),lng=c(mapping_Miami_Dolphins_2016[i,]$Visit_long,mapping_New_York_Giants_2016[i,]$Home_long)) %>%
  addMarkers(
    lng = mapping_New_York_Giants_2016[i,]$Home_long, lat = mapping_New_York_Giants_2016[i,]$Home_lat,
    label = mapping_New_York_Giants_2016[i,]$Home_Team,
    labelOptions = labelOptions(noHide = T))

NY_Giants_mapping_2016
```



