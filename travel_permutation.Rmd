---
title: "travel_permutation"
author: "Aoi Ogawa"
date: "4/21/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
# importing libraries
library(datasets)
library(maps)
library(tidyr)
library(tidyverse)
library(readr)
# install.packages("geosphere")
library(geosphere)
library(dplyr)
library(sp)
library(leaflet)
library(magrittr)
library(janitor)
library(lubridate)
```

```{r,include=FALSE}
stadium_data_coordinates <- read.csv("stadium_data_coordinates.csv")
visit_team_data <- read.csv("visit_team_data.csv")
ns_data_coordinates <- read.csv("Ns_data_coordinates.csv")
all_data_coordinates <- read.csv("All_data_coordinates.csv")

games <-read.csv("data/games_Smith.csv") %>% 
  clean_names() %>%
  mutate(game_date = str_replace(game_date, "T00:00:00Z", ""),
         game_date = as.Date(game_date, "%Y-%m-%d")) 
#pbp
pbp<-read.csv("data/pbp_Smith.csv") %>% 
  clean_names() %>% 
  mutate(
    game_clock = as.numeric(as.period(ms(game_clock), unit = "sec")),
    game_clock = 
      case_when(quarter == 1 ~ game_clock,
                quarter == 2 ~ game_clock + 900,
                quarter == 3 ~ game_clock + 1800,
                quarter == 4 ~ game_clock + 2700,
                quarter == 5 ~ game_clock + 3600))

#data (combined)
data <- games %>% 
  left_join(pbp, by="game_key")
#note: NAs for 2007-2010 in pbp

#fulldata_with_thurs 
fulldata_with_thurs <- data %>% 
  mutate(is_thurs = ifelse(game_day == "Thursday", 1, 0)) %>% 
  mutate(is_thurs = as.factor(is_thurs),
         stadium = as.character(stadium),
         home_team = as.character(home_team),
         visit_team = as.character(visit_team),
         location = as.character(location),
         game_key = as.factor(game_key), 
         season = as.factor(season),
         week = as.factor(week),
         game_weather = as.character(game_weather),
         wind_speed = as.character(wind_speed),
         wind_direction = as.character(wind_direction),
         quarter = as.factor(quarter),
         play_description = as.character(play_description),
         down = as.factor(down),
         is_scoring_play = as.factor(is_scoring_play))

#cleaning df column names to have a common variable with games (home_team)
stadium_data_coordinates <- stadium_data_coordinates %>% 
  clean_names() %>%
  rename(Stadium = stadium) %>%
  rename(Home_Team = home_team) %>%
  rename(Season = season)

games_w_coordinates <- fulldata_with_thurs %>%
  inner_join(stadium_data_coordinates)

games_w_coordinates <- games_w_coordinates %>%
  inner_join(visit_team_data)

games_w_coordinates$num <-NULL
games_w_coordinates$additional_info_location <- NULL
colnames(games_w_coordinates)[colnames(games_w_coordinates) == 'longitude'] <- 'Home_lat'
colnames(games_w_coordinates)[colnames(games_w_coordinates) == 'latitude'] <- 'Home_long'

games_w_coordinates <- games_w_coordinates[!duplicated(games_w_coordinates$GameKey), ]

remove.list <- paste(c('Wembley Stadium',"Rogers Centre","Wembley","Twickenham","Estadio Azteca","Twickenham Stadium","Azteca Stadium","Tottenham Hotspur Stadium","Tottenham Hotspur"), collapse = '|')

domestic_games <- games_w_coordinates %>%
  filter(!grepl(remove.list, Stadium))

domestic_games <- domestic_games[!duplicated(domestic_games$GameKey), ]

international_games <- games_w_coordinates %>%
  filter(grepl(remove.list, Stadium))

international_games <- international_games[!duplicated(international_games$GameKey), ]
```

