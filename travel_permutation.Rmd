---
title: "travel_permutation"
author: "Aoi Ogawa"
date: "4/21/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
# importing libraries
library(datasets)
library(maps)
library(tidyr)
library(tidyverse)
library(readr)
# install.packages("geosphere")
library(geosphere)
library(dplyr)
library(sp)
library(leaflet)
library(magrittr)
library(janitor)
library(lubridate)
```


```{r, include=FALSE}
# importing data
games<-read.csv("data/games_Smith.csv")
stadium_data_coordinates <- read.csv("stadium_data_coordinates.csv")
visit_team_data <- read.csv("visit_team_data.csv")
ns_data_coordinates <- read.csv("Ns_data_coordinates.csv")
all_data_coordinates <- read.csv("All_data_coordinates.csv")
```

```{r,include=FALSE}
#cleaning df column names to have a common variable with games (home_team)
stadium_data_coordinates <- stadium_data_coordinates %>% 
  clean_names() %>%
  rename(Stadium = stadium) %>%
  rename(Home_Team = home_team) %>%
  rename(Season = season)

games_w_coordinates <- games %>%
  inner_join(stadium_data_coordinates)

games_w_coordinates <- games_w_coordinates %>%
  inner_join(visit_team_data)

games_w_coordinates$num <-NULL
games_w_coordinates$additional_info_location <- NULL
colnames(games_w_coordinates)[colnames(games_w_coordinates) == 'longitude'] <- 'Home_lat'
colnames(games_w_coordinates)[colnames(games_w_coordinates) == 'latitude'] <- 'Home_long'

games_w_coordinates <- games_w_coordinates[!duplicated(games_w_coordinates$GameKey), ]

remove.list <- paste(c('Wembley Stadium',"Rogers Centre","Wembley","Twickenham","Estadio Azteca","Twickenham Stadium","Azteca Stadium","Tottenham Hotspur Stadium","Tottenham Hotspur"), collapse = '|')

domestic_games <- games_w_coordinates %>%
  filter(!grepl(remove.list, Stadium)) %>%
  mutate(is_thurs = ifelse(Game_Day == "Thursday", 1, 0)) 

domestic_games <- domestic_games[!duplicated(domestic_games$GameKey), ]

international_games <- games_w_coordinates %>%
  filter(grepl(remove.list, Stadium)) %>%
  mutate(is_thurs = ifelse(Game_Day == "Thursday", 1, 0)) 

international_games <- international_games[!duplicated(international_games$GameKey), ]


```


```{r}

# calculate distance

calc_domestic <- domestic_games %>% 
  rowwise() %>%
  mutate(distance_m = distCosine(c(Home_long, Home_lat),c(Visit_long, Visit_lat))) %>%
  mutate(distance_mile = distance_m*0.6214/1000)

# calc_domestic <- calc_domestic[!duplicated(calc_domestic$Gamekey), ]

calc_domestic <- calc_domestic %>%
  mutate(distance = ifelse(distance_mile > 2000, "very far",
                           ifelse(distance_mile > 1000 && distance_mile <= 2000, "far", "close"))) %>%
  mutate(color_dis = ifelse(distance == "very far", "red",
                        ifelse(distance == "far", "orange",
                               "cyan")))

```


```{r}
# create a dataset which summarised the total travel distance on Thursday or not Thursday 

sum_distance_season <- calc_domestic %>%
  group_by(Visit_Team,Season,is_thurs) %>%
  summarise(travel_dis = sum(distance_mile))%>%
  rename(team = Visit_Team)

num_games_season_visit <- calc_domestic %>%
  group_by(Visit_Team,Season,is_thurs) %>%
  summarise(num_game_visit =n()) %>%
  rename(team = Visit_Team)

# function to get sem
se <- function(x) sqrt(var(x)/length(x))

# get sem
games_season_sem <- calc_domestic %>%
  group_by(Visit_Team,Season,is_thurs) %>%
  summarise(sem=se(distance_mile)) %>%
  rename(team=Visit_Team)

num_games_season_home <- calc_domestic %>%
  group_by(Home_Team,Season,is_thurs) %>%
  summarise(num_game_home =n()) %>%
  rename(team = Home_Team)

distance_season <- sum_distance_season %>%
  inner_join(num_games_season_visit) %>%
  inner_join(num_games_season_home)%>%
  mutate(total_game = num_game_visit + num_game_home) %>%
  inner_join(games_season_sem) %>%
  mutate(avg_travel = travel_dis/total_game)


sum_distance_all <- calc_domestic %>%
  group_by(Visit_Team,is_thurs) %>%
  summarise(travel_dis =sum(distance_mile)) %>%
  rename(Team = Visit_Team)


num_games_visit <- calc_domestic %>%
  group_by(Visit_Team,is_thurs) %>%
  summarise(num_game_visit =n()) %>%
  rename(Team = Visit_Team)

num_games_home <- calc_domestic %>%
  group_by(Home_Team,is_thurs) %>%
  summarise(num_game_home =n()) %>%
  rename(Team = Home_Team)


# get the standard error mean for travel distance
all_games_sem <- calc_domestic %>%
  group_by(Visit_Team,is_thurs) %>%
  summarise(sem = se(distance_mile)) 


distance_all <- sum_distance_all %>%
  inner_join(num_games_visit) %>%
  left_join(num_games_home)%>%
  mutate(total_game = num_game_visit + num_game_home) %>%
  mutate(avg_travel = travel_dis/total_game)

# max(distance_all$avg_travel)-min(distance_all$avg_travel)
```
15 thurs vs 30 sun
mix 45 take the average 
randomly assign thurs and suns 
sometimes diff is 0 or grater than 0 
find the average 
do in a loop --> and make a distribution
and compare statistics between the data 
compare the mean mean and the distribution mean 

sample()
vector or all sunday and thurs so no team names 

shuffle the thursday or sunday order but keep the # of sun and thursday 
--> infer package

two sample t-test difference in mean 
use t-distribution maynot --> permutation 

hypothesize 


ex) 
 specify(am ~ vs, success = "1") %>%
  hypothesize(null = "independence") %>%
  generate(reps = 100, type = "permute")



